function likelihood_by_state = get_likelihood_by_state(state_number, num_linear_distance_bins, ...
    spike_inds, mark_spike_by_tetrode, mark_spike_by_tetrode_number, marks, ...
    mark_spikes_to_linear_position_time_bins_index, gaussian_kernel_position_estimator, position_occupancy, estimated_rate_by_tetrode, dt, smker)
likelihood_by_tetrode = zeros(num_linear_distance_bins, length(spike_inds));
for spike_number = 1:length(spike_inds)
    tetrode_ind = find(mark_spike_by_tetrode(spike_inds(spike_number), :));
    likelihood_by_tetrode(:, spike_number) = get_likelihood_by_tetrode(mark_spike_by_tetrode_number(spike_inds(spike_number), tetrode_ind), ...
        marks{tetrode_ind}, mark_spikes_to_linear_position_time_bins_index{tetrode_ind, state_number}, ...
        gaussian_kernel_position_estimator{tetrode_ind, state_number}, position_occupancy{state_number}, ...
        estimated_rate_by_tetrode{tetrode_ind, state_number}, dt, smker);
end
likelihood_by_state = prod(likelihood_by_tetrode, 2);
likelihood_by_state = likelihood_by_state ./ sum(likelihood_by_state);
end